#!/usr/bin/env node

var program = require('commander')
  , pwd = process.cwd()
  , browserbuild = require('../lib/browserbuild.js')
  , list = function(v){return v.split(/ *, */)}
  , alist = function(v){
        var aliases = {};
        v.split(/ *, */).forEach(function(a) {
            var s = a.split(/=/);
            aliases[s[0]] = s[1];
        });
        return aliases;
  }

// program

program
  .version(require('../package').version)
  .usage('[options] <file â€¦>')
  .option('-b, --basepath [paths]', 'List of base paths of supplied files ['+ pwd + '].', list, [pwd])
  .option('--aliases [aliases]', 'List of aliases', alist, {})
  .option('-d, --debug', 'Includes visionmedia/debug for a dev build.')
  .parse(process.argv)

// validate

if (!program.args.length) {
  console.error('\n  Please supply files.\n');
  return;
}
// process arguments

browserbuild(program.args, program)
  .render(function (err, txt) {
    console.log(txt);
  });
